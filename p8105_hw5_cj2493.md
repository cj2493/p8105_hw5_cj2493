p8105\_hw5\_cj2493
================
Courtney Johnson
November 6, 2018

Problem 1
---------

Create a tidy dataframe from all participants, including the subject ID, arm, and observations over time.

``` r
files_df = 
tibble(vec_files = list.files(path = "./data"), 
       vec_file_path = str_c("./data/", vec_files)) %>%
  mutate(observations = purrr::map(vec_file_path, read_csv)) %>%
  unnest() %>%
  janitor::clean_names() %>%
  separate(vec_files, into = c("arm", "subject"), sep = "_") %>%
  separate(subject, into = c("subject", "extension"), sep = "\\.") %>%
  select(-extension, -vec_file_path) %>%
  gather(key = week, value = measurement, week_1:week_8) %>%
  separate(week, into = c("word", "week"), sep = "_") %>%
  select(-word) %>%
  mutate(subject = as.factor(subject),
         arm = as.factor(arm),
         week = as.numeric(week)) 
head(files_df)
```

    ## # A tibble: 6 x 4
    ##   arm   subject  week measurement
    ##   <fct> <fct>   <dbl>       <dbl>
    ## 1 con   01          1        0.2 
    ## 2 con   02          1        1.13
    ## 3 con   03          1        1.77
    ## 4 con   04          1        1.04
    ## 5 con   05          1        0.47
    ## 6 con   06          1        2.37

Make a spaghetti plot showing observations on each subject over time, and comment on differences between groups.

``` r
files_df %>%
  ggplot(aes(x = week, y = measurement, color = subject)) +
  geom_line() +
  facet_grid(~arm) +
  labs(x = "Week",
       y = "Measurement")
```

<img src="p8105_hw5_cj2493_files/figure-markdown_github/spag_plot-1.png" width="90%" />

For the control arm, the observations over time jump a lot, but seem to be vary around a stable average. However, for the experimental arm, the observations seem to steadily increase over time.

Problem 2
---------

``` r
city_homicides = read_csv("https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv") 
```

    ## Parsed with column specification:
    ## cols(
    ##   uid = col_character(),
    ##   reported_date = col_integer(),
    ##   victim_last = col_character(),
    ##   victim_first = col_character(),
    ##   victim_race = col_character(),
    ##   victim_age = col_character(),
    ##   victim_sex = col_character(),
    ##   city = col_character(),
    ##   state = col_character(),
    ##   lat = col_double(),
    ##   lon = col_double(),
    ##   disposition = col_character()
    ## )

``` r
city_homicides = city_homicides %>%
  janitor::clean_names() %>%
  mutate(city_state = str_c(city, ", ", state)) 
```

``` r
unsolved_summary = city_homicides %>%
  group_by(city_state) %>% 
  summarize(n = n(),
            sum_unsolved = sum(disposition == "Closed without arrest" | disposition == "Open/No arrest"))

baltimore_unsolved = unsolved_summary %>%
  filter(city_state == "Baltimore, MD")
 
prop_output = prop.test(baltimore_unsolved$sum_unsolved, baltimore_unsolved$n)
broom::tidy(prop_output)
```

    ## # A tibble: 1 x 8
    ##   estimate statistic  p.value parameter conf.low conf.high method
    ##      <dbl>     <dbl>    <dbl>     <int>    <dbl>     <dbl> <chr> 
    ## 1    0.646      239. 6.46e-54         1    0.628     0.663 1-sam~
    ## # ... with 1 more variable: alternative <chr>

``` r
baltimore_estimate = prop_output$estimate
baltimore_conf_int = prop_output$conf.int
```

Now do the same for all of the cities

``` r
prop_pipe = unsolved_summary %>%
  mutate(prop_output = purrr::map2(sum_unsolved, n, prop.test)) %>%
  mutate(prop_output = purrr::map(prop_output, broom::tidy)) %>%
  unnest() %>%
  select(city_state, n, sum_unsolved, estimate, conf.low, conf.high)
```

    ## Warning in .f(.x[[i]], .y[[i]], ...): Chi-squared approximation may be
    ## incorrect

``` r
prop_pipe %>%
  filter(city_state != "Tulsa, AL") %>%
  mutate(city_state = fct_reorder(city_state, estimate)) %>%
  ggplot(aes(x = city_state, y = estimate)) +
  geom_point() +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
  labs(x = "City", 
       y = "Proportion of Total",
       title = "Unsolved Murders in 50 Large Cities in the United States")
```

<img src="p8105_hw5_cj2493_files/figure-markdown_github/unsolved_graph-1.png" width="90%" />
